!function(){"use strict";function e(e){const i=[];if(!e||0===e.length)return{isValid:!1,errors:["No data found in file"]};const s=e[0],t=["Sr.No.","Device Id","Loco No.","Lattitude","Longitude","Station","Event Time","Event Type","Speed","Division Code","Reporting Time"].filter(e=>!(e in s));return t.length>0?(i.push(`Missing required fields: ${t.join(", ")}`),{isValid:!1,errors:i}):(e.slice(0,10).forEach((e,s)=>{const t=s+2;if(e["Sr.No."]?(!Number.isInteger(Number(e["Sr.No."]))||Number(e["Sr.No."])<=0)&&i.push(`Row ${t}: 'Sr.No.' must be a positive integer`):i.push(`Row ${t}: 'Sr.No.' is required`),e["Device Id"]){const s=String(e["Device Id"]).trim();/^\d{4}$/.test(s)?(!Number.isInteger(Number(s))||Number(s)<=0)&&i.push(`Row ${t}: 'Device Id' must be a positive integer`):i.push(`Row ${t}: 'Device Id' must be exactly 4 digits`)}else i.push(`Row ${t}: 'Device Id' is required`);if(e["Loco No."]){const s=String(e["Loco No."]).trim();/^\d{5}$/.test(s)?(!Number.isInteger(Number(s))||Number(s)<=0)&&i.push(`Row ${t}: 'Loco No.' must be a positive integer`):i.push(`Row ${t}: 'Loco No.' must be exactly 5 digits`)}else i.push(`Row ${t}: 'Loco No.' is required`);if(e.Lattitude){const s=parseFloat(e.Lattitude);(isNaN(s)||s<-90||s>90)&&i.push(`Row ${t}: 'Lattitude' must be a valid number between -90 and 90`)}else i.push(`Row ${t}: 'Lattitude' is required`);if(e.Longitude){const s=parseFloat(e.Longitude);(isNaN(s)||s<-180||s>180)&&i.push(`Row ${t}: 'Longitude' must be a valid number between -180 and 180`)}else i.push(`Row ${t}: 'Longitude' is required`);if(e.Station){const s=String(e.Station).trim();(s.length<1||s.length>30)&&i.push(`Row ${t}: 'Station' must be between 1 and 30 characters`)}else i.push(`Row ${t}: 'Station' is required`);if(e["Event Time"]){const s=new Date(e["Event Time"]);isNaN(s.getTime())&&i.push(`Row ${t}: 'Event Time' must be a valid date-time format`)}else i.push(`Row ${t}: 'Event Time' is required`);if(e["Event Type"]){const s=String(e["Event Type"]).trim();(s.length<1||s.length>5)&&i.push(`Row ${t}: 'Event Type' must be between 1 and 5 characters`)}else i.push(`Row ${t}: 'Event Type' is required`);if(e.Speed?(!Number.isInteger(Number(e.Speed))||Number(e.Speed)<0)&&i.push(`Row ${t}: 'Speed' must be a positive integer`):i.push(`Row ${t}: 'Speed' is required`),e["Division Code"]){const s=String(e["Division Code"]).trim();(s.length<1||s.length>20)&&i.push(`Row ${t}: 'Division Code' must be between 1 and 20 characters`)}else i.push(`Row ${t}: 'Division Code' is required`);if(e["Reporting Time"]){const s=new Date(e["Reporting Time"]);isNaN(s.getTime())&&i.push(`Row ${t}: 'Reporting Time' must be a valid date-time format`)}else i.push(`Row ${t}: 'Reporting Time' is required`)}),{isValid:0===i.length,errors:i.slice(0,10)})}function i(e){const i=[];if(!e||0===e.length)return{isValid:!1,errors:["No data found in file"]};const s=e[0],t=["ticket_id","officer_id","location","severity"].filter(e=>!(e in s));return t.length>0&&i.push(`Missing required fields: ${t.join(", ")}`),e.slice(0,10).forEach((e,s)=>{e.ticket_id||i.push(`Row ${s+2}: Missing or empty 'ticket_id'`),e.officer_id||i.push(`Row ${s+2}: Missing or empty 'officer_id'`);e.severity&&!["Low","Medium","High","Critical"].includes(e.severity)&&i.push(`Row ${s+2}: Invalid severity level`)}),{isValid:0===i.length,errors:i.slice(0,5)}}function s(e){const i=[];if(!e||0===e.length)return{isValid:!1,errors:["No data found in file"]};const s=e[0],t=["file_id","document_type","upload_date","status"].filter(e=>!(e in s));return t.length>0&&i.push(`Missing required fields: ${t.join(", ")}`),e.slice(0,10).forEach((e,s)=>{e.file_id||i.push(`Row ${s+2}: Missing or empty 'file_id'`),e.document_type||i.push(`Row ${s+2}: Missing or empty 'document_type'`);e.status&&!["Pending","Approved","Rejected","Archived"].includes(e.status)&&i.push(`Row ${s+2}: Invalid status value`)}),{isValid:0===i.length,errors:i.slice(0,5)}}function t(e){const i=[];if(!e||0===e.length)return{isValid:!1,errors:["No data found in file"]};const s=e[0],t=["case_id","case_number","description","assigned_to"].filter(e=>!(e in s));return t.length>0&&i.push(`Missing required fields: ${t.join(", ")}`),e.slice(0,10).forEach((e,s)=>{e.case_id||i.push(`Row ${s+2}: Missing or empty 'case_id'`),e.case_number||i.push(`Row ${s+2}: Missing or empty 'case_number'`),e.assigned_to||i.push(`Row ${s+2}: Missing or empty 'assigned_to'`)}),{isValid:0===i.length,errors:i.slice(0,5)}}self.onmessage=async r=>{try{const{jsonData:o,fieldName:n,fileName:u,fileSize:d}=r.data,a=function(r,o){const n={RTIS:e,SNT:i,FSD:s,CMS:t}[o];if(!n)return{isValid:!0,errors:[]};return n(r)}(o,n);if(!a.isValid)return void self.postMessage({success:!1,error:a.errors.join("; ")});await new Promise(e=>setTimeout(e,3e3));const c={name:u,size:d,rows:o.length,data:o,processedAt:(new Date).toISOString(),status:"processed",fieldName:n};self.postMessage({success:!0,data:c})}catch(o){self.postMessage({success:!1,error:o.message||"Error processing file"})}}}();
