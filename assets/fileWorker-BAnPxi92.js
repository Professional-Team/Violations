(function(){"use strict";self.onmessage=async n=>{try{const{jsonData:e,fieldName:d,fileName:u,fileSize:o}=n.data,i=a(e,d);if(!i.isValid){self.postMessage({success:!1,error:i.errors.join("; ")});return}await new Promise(s=>setTimeout(s,3e3));const r={name:u,size:o,rows:e.length,data:e,processedAt:new Date().toISOString(),status:"processed",fieldName:d};self.postMessage({success:!0,data:r})}catch(e){self.postMessage({success:!1,error:e.message||"Error processing file"})}};function a(n,e){const u={RTIS:l,SNT:c,FSD:f,CMS:p}[e];return u?u(n):{isValid:!0,errors:[]}}function l(n){const e=[],d=["Sr.No.","Device Id","Loco No.","Lattitude","Longitude","Station","Event Time","Event Type","Speed","Division Code","Reporting Time"];if(!n||n.length===0)return{isValid:!1,errors:["No data found in file"]};const u=n[0],o=d.filter(i=>!(i in u));return o.length>0?(e.push(`Missing required fields: ${o.join(", ")}`),{isValid:!1,errors:e}):(n.slice(0,10).forEach((i,r)=>{const s=r+2;if(i["Sr.No."]?(!Number.isInteger(Number(i["Sr.No."]))||Number(i["Sr.No."])<=0)&&e.push(`Row ${s}: 'Sr.No.' must be a positive integer`):e.push(`Row ${s}: 'Sr.No.' is required`),!i["Device Id"])e.push(`Row ${s}: 'Device Id' is required`);else{const t=String(i["Device Id"]).trim();/^\d{4}$/.test(t)?(!Number.isInteger(Number(t))||Number(t)<=0)&&e.push(`Row ${s}: 'Device Id' must be a positive integer`):e.push(`Row ${s}: 'Device Id' must be exactly 4 digits`)}if(!i["Loco No."])e.push(`Row ${s}: 'Loco No.' is required`);else{const t=String(i["Loco No."]).trim();/^\d{5}$/.test(t)?(!Number.isInteger(Number(t))||Number(t)<=0)&&e.push(`Row ${s}: 'Loco No.' must be a positive integer`):e.push(`Row ${s}: 'Loco No.' must be exactly 5 digits`)}if(!i.Lattitude)e.push(`Row ${s}: 'Lattitude' is required`);else{const t=parseFloat(i.Lattitude);(isNaN(t)||t<-90||t>90)&&e.push(`Row ${s}: 'Lattitude' must be a valid number between -90 and 90`)}if(!i.Longitude)e.push(`Row ${s}: 'Longitude' is required`);else{const t=parseFloat(i.Longitude);(isNaN(t)||t<-180||t>180)&&e.push(`Row ${s}: 'Longitude' must be a valid number between -180 and 180`)}if(!i.Station)e.push(`Row ${s}: 'Station' is required`);else{const t=String(i.Station).trim();(t.length<1||t.length>30)&&e.push(`Row ${s}: 'Station' must be between 1 and 30 characters`)}if(!i["Event Time"])e.push(`Row ${s}: 'Event Time' is required`);else{const t=new Date(i["Event Time"]);isNaN(t.getTime())&&e.push(`Row ${s}: 'Event Time' must be a valid date-time format`)}if(!i["Event Type"])e.push(`Row ${s}: 'Event Type' is required`);else{const t=String(i["Event Type"]).trim();(t.length<1||t.length>5)&&e.push(`Row ${s}: 'Event Type' must be between 1 and 5 characters`)}if(i.Speed?(!Number.isInteger(Number(i.Speed))||Number(i.Speed)<0)&&e.push(`Row ${s}: 'Speed' must be a positive integer`):e.push(`Row ${s}: 'Speed' is required`),!i["Division Code"])e.push(`Row ${s}: 'Division Code' is required`);else{const t=String(i["Division Code"]).trim();(t.length<1||t.length>20)&&e.push(`Row ${s}: 'Division Code' must be between 1 and 20 characters`)}if(!i["Reporting Time"])e.push(`Row ${s}: 'Reporting Time' is required`);else{const t=new Date(i["Reporting Time"]);isNaN(t.getTime())&&e.push(`Row ${s}: 'Reporting Time' must be a valid date-time format`)}}),{isValid:e.length===0,errors:e.slice(0,10)})}function c(n){const e=[],d=["ticket_id","officer_id","location","severity"];if(!n||n.length===0)return{isValid:!1,errors:["No data found in file"]};const u=n[0],o=d.filter(i=>!(i in u));return o.length>0&&e.push(`Missing required fields: ${o.join(", ")}`),n.slice(0,10).forEach((i,r)=>{i.ticket_id||e.push(`Row ${r+2}: Missing or empty 'ticket_id'`),i.officer_id||e.push(`Row ${r+2}: Missing or empty 'officer_id'`);const s=["Low","Medium","High","Critical"];i.severity&&!s.includes(i.severity)&&e.push(`Row ${r+2}: Invalid severity level`)}),{isValid:e.length===0,errors:e.slice(0,5)}}function f(n){const e=[],d=["file_id","document_type","upload_date","status"];if(!n||n.length===0)return{isValid:!1,errors:["No data found in file"]};const u=n[0],o=d.filter(i=>!(i in u));return o.length>0&&e.push(`Missing required fields: ${o.join(", ")}`),n.slice(0,10).forEach((i,r)=>{i.file_id||e.push(`Row ${r+2}: Missing or empty 'file_id'`),i.document_type||e.push(`Row ${r+2}: Missing or empty 'document_type'`);const s=["Pending","Approved","Rejected","Archived"];i.status&&!s.includes(i.status)&&e.push(`Row ${r+2}: Invalid status value`)}),{isValid:e.length===0,errors:e.slice(0,5)}}function p(n){const e=[],d=["case_id","case_number","description","assigned_to"];if(!n||n.length===0)return{isValid:!1,errors:["No data found in file"]};const u=n[0],o=d.filter(i=>!(i in u));return o.length>0&&e.push(`Missing required fields: ${o.join(", ")}`),n.slice(0,10).forEach((i,r)=>{i.case_id||e.push(`Row ${r+2}: Missing or empty 'case_id'`),i.case_number||e.push(`Row ${r+2}: Missing or empty 'case_number'`),i.assigned_to||e.push(`Row ${r+2}: Missing or empty 'assigned_to'`)}),{isValid:e.length===0,errors:e.slice(0,5)}}})();
